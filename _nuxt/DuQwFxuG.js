import{u as z,a as Se,s as ls,_ as $e,l as Z}from"./wZ6RlnZv.js";import F from"./BMud-6rD.js";import we from"./DsM4ZZVv.js";import is from"./BGcbwDGz.js";import ae from"./D4FfJGNA.js";import as from"./_Qnz04rh.js";import xe from"./D3tDQp55.js";import{_ as ke,t as u,v as C,N as A,T as fe,y as I,c as L,x as e,M as g,P as R,O as B,z as t,r as x,Q as J,R as N,A as p,W as re,U as K,X as rs,Y as Ce,B as j,$ as ds,S as us,o as Ve,C as cs,D as ps,a0 as _e,G as ge,i as De,a1 as ms,a2 as vs,L as fs,Z as de,a3 as _s}from"./C6MT5xoS.js";import gs from"./D9d3BgMU.js";import bs from"./ifBWRURC.js";import hs from"./B4sBov1h.js";import ys from"./D4ieLdO3.js";import{a as Ue,u as Re,_ as Te}from"./RvE_jmqW.js";import be from"./COdQHunM.js";import Le from"./WzhuaHv1.js";import Ss from"./DQZ89fJC.js";import Be from"./CsJARB8k.js";import $s from"./DKBzCDVH.js";import ws from"./Bge-p9Xp.js";import Me from"./R06UAkzo.js";import xs from"./iAWKRLMq.js";import ks from"./HJvkYjpC.js";import Ne from"./Co69KbJg.js";import Ie from"./Ccgluc1p.js";import je from"./CJDbmsZ-.js";import Cs from"./DAhH6X3F.js";import Vs from"./CDCLQuAb.js";function Ds(o){return o?Object.keys(o).map(n=>({key:n,value:o[n]})):[]}function Us(o){return o.reduce((n,l)=>(n[l.key]=l.value,n),{})}const Rs={class:"metadata"},Ts={__name:"Metadata",props:["metadata"],setup(o){return(n,l)=>(u(),C("div",Rs,[(u(!0),C(A,null,fe(o.metadata,(s,r)=>(u(),C("pre",{key:r},I(r)+"="+I(s),1))),128))]))}},Ls=ke(Ts,[["__scopeId","data-v-cb7cbf08"]]),Bs={class:"text-center p-1"},Ms={class:"text-center"},Ee={__name:"SessionChip",props:{session:Object,image:String},setup(o){const n=o,l=L(()=>{if(n.session.me)return`${n.session.me.id}`});return(s,r)=>{var i,d;const m=gs;return u(),C("div",null,[e("div",Bs,[e("b",Ms,I((d=(i=n.session)==null?void 0:i.me)==null?void 0:d.pushName),1)]),g(l)?(u(),R(m,{key:0,label:g(l),image:o.image},null,8,["label","image"])):B("",!0)])}}},Oe={__name:"RefreshButton",props:["refreshing"],setup(o){const n=o,l=L(()=>n.refreshing?"pi pi-refresh pi-spin":"pi pi-refresh");return(s,r)=>{const m=F;return u(),R(m,{icon:g(l),rounded:"",text:"",disabled:o.refreshing},null,8,["icon","disabled"])}}},Ns=["src"],Is={__name:"Base64Img",props:{data:String,mimetype:String},setup(o){const n=o,l=L(()=>`data:${n.mimetype};base64, ${n.data}`);return(s,r)=>(u(),C("img",{src:l.value,style:{"max-width":"100%"}},null,8,Ns))}},js={key:2,style:{"background-color":"#f8f9fa",padding:"1rem",color:"red","white-space":"pre-wrap"}},Ae={__name:"SessionScreenshot",props:{session:Object},setup(o,{expose:n}){const l=z(),s=o,{data:r,pending:m,error:i,refresh:d}=Se(`session-screenshot-${s.session.server.id}-${s.session.name}`,async()=>(await ls(1e3),await l.getScreenshot(s.session.server.id,s.session.name)));return n({refresh:d}),(f,v)=>{const S=bs,U=hs,h=Is;return u(),C(A,null,[g(m)?(u(),C(A,{key:0},[t(S,{mode:"indeterminate",style:{height:"3px"}}),!g(r)&&!g(i)?(u(),R(U,{key:0,width:"100%",height:"20rem"})):B("",!0)],64)):B("",!0),g(r)?(u(),R(h,{key:1,data:g(r).data,mimetype:g(r).mimetype},null,8,["data","mimetype"])):B("",!0),g(i)?(u(),C("pre",js,""+I(g(i).cause.response.data.message||g(i).cause.response.data||g(i))+`
  `,1)):B("",!0)],64)}}},Es={class:"",style:{"min-width":"20rem"}},Os={class:"flex justify-content-center align-items-center"},As=e("h5",{class:"m-0"},"Screenshot",-1),qs={class:"m-auto w-full"},Fs={__name:"ScreenshotButton",props:["disabled","session"],setup(o){const n=x(null),l=x(null),s=m=>{n.value.toggle(m)},r=()=>{l.value.refresh()};return(m,i)=>{const d=F,f=Oe,v=Ae,S=ys,U=J("tooltip");return u(),C(A,null,[N(t(d,{disabled:o.disabled,type:"button",icon:"pi pi-camera",onClick:s,rounded:"",outlined:""},null,8,["disabled"]),[[U,"Screenshot / QR",void 0,{top:!0}]]),t(S,{ref_key:"op",ref:n,appendTo:"body",showCloseIcon:!0},{default:p(()=>[e("div",Es,[e("div",Os,[As,t(f,{onClick:r})]),e("div",qs,[t(v,{ref_key:"screenshot",ref:l,session:o.session},null,8,["session"])])])]),_:1},512)],64)}}},Hs={class:"ml-1"},Ps={key:1},Ws={class:"ml-1"},qe={__name:"ServerDropdown",props:re({showClear:Boolean,placeholder:String,required:Boolean,invalid:Boolean,disabled:Boolean},{server:{},serverModifiers:{}}),emits:["update:server"],setup(o){const n=K(o,"server"),l=z();return(s,r)=>{const m=Ue,i=be;return u(),R(i,{optionValue:"id",modelValue:n.value,"onUpdate:modelValue":r[0]||(r[0]=d=>n.value=d),options:g(l).servers,onChange:r[1]||(r[1]=d=>s.$emit("change",n.value)),placeholder:o.placeholder,class:"p-column-filter",showClear:o.showClear,required:o.required,invalid:o.invalid,disabled:o.disabled},{value:p(d=>[d.value?(u(),C(A,{key:0},[t(m,{connected:g(l).getServer(d.value).connected},null,8,["connected"]),e("span",Hs,I(g(l).getServer(d.value).name),1)],64)):(u(),C("span",Ps,I(d.placeholder),1))]),option:p(d=>[t(m,{connected:d.option.connected},null,8,["connected"]),e("span",Ws,I(d.option.name)+" ("+I(d.option.connection.url)+") ",1)]),_:1},8,["modelValue","options","placeholder","showClear","required","invalid","disabled"])}}},Ks={class:"flex flex-row gap-2 justify-content-end"},Fe={__name:"SessionActionButtons",props:["name","isStarting","isRestarting","isStopping","isLoggingOut","isRemoving","allDisabled","hideActions","skipConfirmation","group"],emits:["view","start","restart","stop","logout","delete"],setup(o,{emit:n}){const l=rs(),s=o,r=n;function m(h){return s.skipConfirmation?!s.skipConfirmation.includes(h):!0}async function i(){if(!m("start")){r("start");return}l.require({group:s.group,target:event.target,message:`Start ${s.name}?`,icon:"pi pi-exclamation-triangle",rejectClass:"p-button-secondary p-button-outlined p-button-sm",acceptClass:"p-button-success p-button-sm",rejectLabel:"No",acceptLabel:"Yes, Start",accept:()=>{r("start")},reject:()=>{}})}const d=L(()=>s.hideActions?!s.hideActions.includes("view"):!0);function f(h){l.require({group:s.group,target:h.target,message:`Restart ${s.name}?`,icon:"pi pi-exclamation-triangle",rejectClass:"p-button-secondary p-button-outlined p-button-sm",acceptClass:"p-button-info p-button-sm",rejectLabel:"No",acceptLabel:"Yes, Restart",accept:()=>{r("restart")},reject:()=>{}})}function v(h){l.require({group:s.group,target:h.target,message:`Stop ${s.name}?`,icon:"pi pi-exclamation-triangle",rejectClass:"p-button-secondary p-button-outlined p-button-sm",acceptClass:"p-button-warning p-button-sm",rejectLabel:"No",acceptLabel:"Yes, Stop",accept:async()=>{r("stop")},reject:()=>{}})}function S(h){l.require({group:s.group,target:h.target,message:`Logout ${s.name}?`,icon:"pi pi-exclamation-triangle",rejectClass:"p-button-secondary p-button-outlined p-button-sm",acceptClass:"p-button-warning p-button-sm",rejectLabel:"No",acceptLabel:"Yes, Logout",accept:async()=>{r("logout")},reject:()=>{}})}function U(h){l.require({group:s.group,target:h.target,message:`Delete ${s.name}?`,icon:"pi pi-exclamation-triangle",rejectClass:"p-button-secondary p-button-outlined p-button-sm",acceptClass:"p-button-danger p-button-sm",rejectLabel:"No",acceptLabel:"Yes, Delete",accept:async()=>{r("delete")},reject:()=>{}})}return(h,k)=>{const V=F,$=Le,a=Ss,c=J("tooltip");return u(),C(A,null,[e("div",Ks,[g(d)?N((u(),R(V,{key:0,icon:"pi pi-cog",severity:"help",rounded:"",outlined:"",onClick:k[0]||(k[0]=M=>h.$emit("view")),disabled:o.allDisabled},null,8,["disabled"])),[[c,"Configuration",void 0,{top:!0}]]):B("",!0),N(t(V,{icon:"pi pi-play",severity:"success",rounded:"",outlined:"",onClick:i,loading:o.isStarting,disabled:o.allDisabled},null,8,["loading","disabled"]),[[c,"Start",void 0,{top:!0}]]),N(t(V,{icon:"pi pi-replay",severity:"info",rounded:"",outlined:"",onClick:k[1]||(k[1]=M=>f(M)),loading:o.isRestarting,disabled:o.allDisabled},null,8,["loading","disabled"]),[[c,"Restart",void 0,{top:!0}]]),N(t(V,{icon:"pi pi-stop",severity:"secondary",rounded:"",outlined:"",onClick:k[2]||(k[2]=M=>v(M)),loading:o.isStopping,disabled:o.allDisabled},null,8,["loading","disabled"]),[[c,"Stop",void 0,{top:!0}]]),N(t(V,{icon:"pi pi-sign-out",severity:"warning",rounded:"",outlined:"",onClick:k[3]||(k[3]=M=>S(M)),loading:o.isLoggingOut,disabled:o.allDisabled},null,8,["loading","disabled"]),[[c,"Logout",void 0,{top:!0}]]),N(t(V,{icon:"pi pi-trash",severity:"danger",rounded:"",outlined:"",onClick:k[4]||(k[4]=M=>U(M)),loading:o.isRemoving,disabled:o.allDisabled},null,8,["loading","disabled"]),[[c,"Delete",void 0,{top:!0}]])]),o.group==="popup"?(u(),R($,{key:0,group:"popup"})):B("",!0),o.group==="dialog"?(u(),R(a,{key:1,group:"dialog"})):B("",!0)],64)}}},zs={class:"flex flex-row gap-2 justify-content-end"},Js={__name:"SessionActions",props:["session","disabled"],setup(o,{expose:n}){const l=o,s=z(),r=Re(),m=x(!1),i=x(!1),d=x(!1),f=x(!1),v=x(!1),S=L(()=>l.disabled||m.value||i.value||d.value||f.value||v.value);async function U(){const a=l.session;f.value=!0,await r(s.startSession(a.server.id,a.name),"Started","Failed to start session",a.name,a.name).finally(()=>f.value=!1)}async function h(){const a=l.session;v.value=!0,await r(s.restartSession(a.server.id,a.name),"Restarted","Failed to restart session",a.name,a.name).finally(()=>v.value=!1)}async function k(){const a=l.session;m.value=!0,await r(s.stopSession(a.server.id,a.name),"Stopped","Failed to stop session",a.name,a.name).finally(()=>m.value=!1)}async function V(){const a=l.session;i.value=!0,await r(s.logoutSession(a.server.id,a.name),"Logged out","Failed to logout session",a.name,a.name).finally(()=>i.value=!1)}async function $(){const a=l.session;d.value=!0,await r(s.deleteSession(a.server.id,a.name),"Deleted","Failed to delete session",a.name,a.name).finally(()=>d.value=!1)}return n({startSession:U,restartSession:h,stopSession:k,logoutSession:V,deleteSession:$}),(a,c)=>{const M=Fe;return u(),C("div",zs,[t(M,{group:"popup",name:`'${o.session.name}' session`,onView:c[0]||(c[0]=Y=>a.$emit("view",o.session)),onStart:U,onRestart:h,onStop:k,onLogout:V,onDelete:$,"is-starting":g(f),"is-restarting":g(v),"is-stopping":g(m),"is-logging-out":g(i),"is-removing":g(d),"all-disabled":g(S),"hide-actions":[],"skip-confirmation":["start"]},null,8,["name","is-starting","is-restarting","is-stopping","is-logging-out","is-removing","all-disabled"])])}}},Ys={class:"p-dialog-title flex gap-2 align-items-center"},Gs=e("i",{class:"pi pi-whatsapp"},null,-1),Qs=e("span",null,"(",-1),Xs={class:"ml-1"},Zs=e("span",null,")",-1),eo=["disabled"],so=e("i",{class:"pi pi-refresh"},null,-1),oo=[so],He={__name:"SessionHeader",props:{session:Object,refresh:Boolean},setup(o){const n=o,l=z(),{refreshing:s}=Ce(l),r=L(()=>n.session.server.id?n.session.server:l.getServer(n.session.server));async function m(){await l.refresh()}return(i,d)=>{var h,k;const f=Te,v=Ue,S=$e,U=J("tooltip");return u(),C("div",Ys,[Gs,e("span",null,I((h=o.session)==null?void 0:h.name),1),t(f,{status:o.session.status,value:(k=o.session.status)==null?void 0:k.toUpperCase()},null,8,["status","value"]),e("div",null,[Qs,t(v,{connected:r.value.connected},null,8,["connected"]),e("span",Xs,I(r.value.name),1),Zs]),o.refresh?N((u(),C("button",{key:0,onClick:d[0]||(d[0]=V=>m()),class:"p-link layout-topbar-button",disabled:g(s)},oo,8,eo)),[[U,"Refresh",void 0,{top:!0}]]):B("",!0),t(S,{refreshing:g(s)},null,8,["refreshing"])])}}},to={class:"-mt-4 p-0 line-height-3 block",style:{"font-family":"monaco, Consolas, 'Lucida Console', monospace"}},no={__name:"CodeHighlight",props:["invalid"],setup(o){const n=o,l=L(()=>n.invalid?"p-invalid p-component p-inputtext":"");return(s,r)=>(u(),C("pre",{class:us(["border-round surface-ground text-900 p-5 overflow-auto",l.value])},[j("        "),e("code",to,[ds(s.$slots,"default")])],2))}},he=o=>(cs("data-v-aa1b18ec"),o=o(),ps(),o),lo={class:"h-full flex flex-column"},io={class:"flex justify-content-center align-items-center"},ao=he(()=>e("h5",{class:"m-0"},"Request",-1)),ro={class:"flex flex-column justify-content-between h-full"},uo={class:"flex flex-column gap-2"},co={class:"flex gap-2"},po={class:"text-center"},mo=he(()=>e("div",{class:"mb-2"},"Body",-1)),vo={class:"text-center mt-2"},fo={class:"flex flex-column h-full"},_o={class:"flex justify-content-center align-items-center"},go=he(()=>e("h5",{class:"m-0"},"Response",-1)),bo={__name:"SessionRequestResponse",props:["session"],setup(o){const n=z(),l=o,s=x(null),r=x("POST"),m=x("/api/sendText"),i=x(""),d=x(!1),f=x(!1);function v(a){return JSON.stringify(a,null,2)}function S(a){try{return JSON.parse(a)}catch{return a}}const U=L(()=>({method:r.value,uri:m.value,params:void 0,body:S(i.value)})),h=["GET","POST","PUT","DELETE","PATCH"];async function k(a){await navigator.clipboard.writeText(s.value),a.preventDefault()}async function V(a){await navigator.clipboard.writeText(v(U.value)),a.preventDefault()}async function $(){try{f.value=!1,d.value=!0;const a=await n.callServerAPI(l.session.server.id,U.value);s.value=v(a)}catch(a){f.value=!0,a.response?s.value=v(a.response.data):s.value=v(a)}finally{d.value=!1}}return Ve(()=>{const a={chatId:"11111111111@c.us",text:"Hi there!",session:l.session.name};i.value=v(a),s.value="..."}),(a,c)=>{const M=F,Y=be,ee=ae,E=$s,le=ws,O=no,G=J("tooltip");return u(),C(A,null,[e("div",null,[e("div",lo,[e("div",io,[ao,N(t(M,{rounded:"",text:"",tabindex:0,icon:"pi pi-copy",onClick:c[0]||(c[0]=y=>V(y))},null,512),[[G,{value:"Copied to clipboard"},void 0,{focus:!0,bottom:!0}]])]),e("div",ro,[e("div",uo,[e("div",co,[t(Y,{modelValue:r.value,"onUpdate:modelValue":c[1]||(c[1]=y=>r.value=y),options:h},null,8,["modelValue"]),t(ee,{type:"text",class:"w-full",modelValue:m.value,"onUpdate:modelValue":c[2]||(c[2]=y=>m.value=y),placeholder:"API Endpoint"},null,8,["modelValue"])]),e("div",po,[mo,t(E,{modelValue:i.value,"onUpdate:modelValue":c[3]||(c[3]=y=>i.value=y),rows:"8",class:"w-full",placeholder:"Request"},null,8,["modelValue"])])]),e("div",vo,[t(M,{onClick:$,loading:d.value,label:"Send",icon:"pi pi-send","icon-pos":"right"},null,8,["loading"])])])])]),t(le),e("div",null,[e("div",fo,[e("div",_o,[go,N(t(M,{rounded:"",text:"",tabindex:0,icon:"pi pi-copy",onClick:c[4]||(c[4]=y=>k(y))},null,512),[[G,{value:"Copied to clipboard"},void 0,{focus:!0,bottom:!0}]])]),t(O,{class:"m-0 p-4 pretty",invalid:f.value},{default:p(()=>[j(I(s.value),1)]),_:1},8,["invalid"])])])],64)}}},ho=ke(bo,[["__scopeId","data-v-aa1b18ec"]]),yo={class:"grid pt-4"},So={class:"col-12 sm:col-6 h-full"},$o={class:"grid"},wo={class:"col-12"},xo={class:""},ko={class:"flex justify-content-center align-items-center"},Co={class:"col-12"},Vo={class:""},Do={class:"flex justify-content-center align-items-center"},Uo=e("h5",{class:"m-0"},"Screenshot",-1),Ro={class:"m-auto w-full"},To={class:"col-12 sm:col-6 h-full card"},Lo={__name:"SessionControl",props:["session"],setup(o){const n=z(),l=o,s=x(null),r=()=>{s.value.refresh()},m=x(null);return Ve(()=>{var i,d;(d=(i=l.session)==null?void 0:i.me)!=null&&d.id&&n.getProfilePicture(l.session.server.id,l.session.name,l.session.me.id).then(f=>{m.value=f.profilePictureURL})}),(i,d)=>{const f=Ee,v=Oe,S=Ae,U=ho;return u(),C("div",yo,[e("div",So,[e("div",$o,[e("div",wo,[e("div",xo,[e("div",ko,[o.session.me?(u(),R(f,{key:0,session:o.session,image:g(m)},null,8,["session","image"])):B("",!0)])])]),e("div",Co,[e("div",Vo,[e("div",Do,[Uo,t(v,{onClick:r})]),e("div",Ro,[t(S,{ref_key:"screenshot",ref:s,session:o.session},null,8,["session"])])])])])]),e("div",To,[t(U,{session:o.session},null,8,["session"])])])}}},Bo={__name:"SessionControlDialog",props:{visible:{},visibleModifiers:{},session:{},sessionModifiers:{}},emits:["update:visible","update:session"],setup(o){const n=K(o,"visible"),l=K(o,"session");return _e(),(s,r)=>{const m=He,i=Lo,d=Me;return u(),R(d,{visible:n.value,"onUpdate:visible":r[0]||(r[0]=f=>n.value=f),modal:!0,maximizable:""},{header:p(()=>[t(m,{session:l.value},null,8,["session"])]),default:p(()=>[t(i,{session:l.value},null,8,["session"])]),_:1},8,["visible"])}}},Mo={class:"card p-fluid"},No={class:"flex flex-grow-1 justify-content-center"},Io={class:"flex flex-grow-1 justify-content-center"},Pe={__name:"KeyValueTable",props:re(["keyColumn","keyColumnName","prefix"],{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(o){const n=K(o,"modelValue"),l=o,s=x([]),r=f=>{let{newData:v,index:S}=f;n.value[S]=v},m=f=>{let{data:v,newValue:S,field:U}=f;v[U]=S};function i(){const f=n.value.length+1,v=`${l.prefix}${f}`;n.value.unshift({[l.keyColumn]:v,value:"123"})}function d(f){n.value.splice(f,1)}return(f,v)=>{const S=ae,U=xe,h=F,k=Be,V=J("tooltip");return u(),C("div",Mo,[t(k,{editingRows:s.value,"onUpdate:editingRows":v[0]||(v[0]=$=>s.value=$),value:n.value,editMode:"cell",dataKey:l.keyColumn,onRowEditSave:r,onCellEditComplete:m,pt:{table:{style:"min-width: 50rem"},column:{bodycell:({state:$})=>({style:$.d_editing&&"padding-top: 0.6rem; padding-bottom: 0.6rem"})}}},{default:p(()=>[t(U,{field:l.keyColumn,header:l.keyColumnName,style:{width:"40%"}},{editor:p(({data:$,field:a})=>[t(S,{modelValue:$[a],"onUpdate:modelValue":c=>$[a]=c},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["field","header"]),t(U,{style:{width:"40%"},field:"value",header:"Value"},{editor:p(({data:$,field:a})=>[t(S,{modelValue:$[a],"onUpdate:modelValue":c=>$[a]=c},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(U,{style:{"min-width":"1rem"}},{header:p(()=>[e("div",No,[N(t(h,{label:"",rounded:"",text:"",style:{height:"2rem",width:"2rem"},icon:"pi pi-plus",severity:"success",onClick:i},null,512),[[V,"Add",void 0,{top:!0}]])])]),body:p(({index:$})=>[e("div",Io,[N(t(h,{label:"",rounded:"",text:"",style:{height:"2rem",width:"2rem"},icon:"pi pi-trash",severity:"warning",onClick:a=>d($)},null,8,["onClick"]),[[V,"Delete",void 0,{top:!0}]])])]),_:1})]),_:1},8,["editingRows","value","dataKey","pt"])])}}},jo={class:"flex justify-content-between align-items-center w-full"},Eo={class:"field"},Oo=e("label",{for:"url"},"URL",-1),Ao={class:"field mb-4"},qo=e("label",{for:"events"},"Events",-1),Fo=e("div",{class:"font-bold mb-2"},"Retries",-1),Ho={class:"flex gap-3"},Po={class:"field"},Wo=e("label",{for:"retries-attempts"},"Attempts",-1),Ko=e("span",{class:"pi pi-plus"},null,-1),zo=e("span",{class:"pi pi-minus"},null,-1),Jo={class:"field"},Yo=e("label",{for:"retries-delay-seconds"},"Delay, seconds",-1),Go=e("span",{class:"pi pi-plus"},null,-1),Qo=e("span",{class:"pi pi-minus"},null,-1),Xo={class:"field"},Zo=e("label",{for:"hmac"},"HMAC Key (optional)",-1),et={class:"field"},st={class:"field flex justify-content-between align-items-center"},ot=e("div",null,[e("label",{for:"hmac"},"Custom Headers (optional)")],-1),tt={__name:"SessionWebhook",props:re({disabled:Boolean,index:Number},{webhook:{},webhookModifiers:{}}),emits:["update:webhook"],setup(o){const n=K(o,"webhook"),l=o,s=["session.status","message","message.any","message.reaction","message.ack","message.revoked","chat.archive","group.join","group.leave","presence.update","poll.vote","poll.vote.failed","call.received","call.accepted","call.rejected","label.upsert","label.deleted","label.chat.added","label.chat.deleted"],r=x(n.value.customHeaders&&n.value.customHeaders.length>0);return ge(r,(m,i)=>{if(i&&!m){n.value.customHeaders=null;return}!i&&m&&(n.value.customHeaders=[{name:"X-Header-1",value:"123"}])}),(m,i)=>{const d=F,f=ae,v=we,S=Cs,U=De("font-awesome-icon"),h=Ne,k=Pe,V=Ie,$=je,a=J("tooltip");return u(),R($,{activeIndex:0},{default:p(()=>[t(V,null,{header:p(()=>[e("div",jo,[e("div",null," Webhook "+I(l.index+1),1),e("div",null,[N(t(d,{label:"",text:"",rounded:"",style:{height:"2rem",width:"2rem"},icon:"pi pi-trash",severity:"warning",onClick:i[0]||(i[0]=c=>m.$emit("remove"))},null,512),[[a,"Delete Webhook",void 0,{top:!0}]])])])]),default:p(()=>[e("div",Eo,[Oo,t(f,{id:"url",modelValue:n.value.url,"onUpdate:modelValue":i[1]||(i[1]=c=>n.value.url=c),modelModifiers:{trim:!0},required:"true",disabled:o.disabled},null,8,["modelValue","disabled"])]),e("div",Ao,[qo,t(v,{id:"events",modelValue:n.value.events,"onUpdate:modelValue":i[2]||(i[2]=c=>n.value.events=c),options:s,placeholder:"Select Events","max-selected-labels":1,selectedItemsLabel:"{0} events selected",disabled:o.disabled},null,8,["modelValue","disabled"]),e("ul",null,[(u(!0),C(A,null,fe(n.value.events,c=>(u(),C("li",{key:c},I(c),1))),128))])]),e("div",null,[Fo,e("div",Ho,[e("div",Po,[Wo,t(S,{modelValue:n.value.retries.attempts,"onUpdate:modelValue":i[3]||(i[3]=c=>n.value.retries.attempts=c),inputId:"retries-delay-attempts",showButtons:"",buttonLayout:"horizontal",min:1,step:1,disabled:o.disabled},{incrementbuttonicon:p(()=>[Ko]),decrementbuttonicon:p(()=>[zo]),_:1},8,["modelValue","disabled"])]),e("div",Jo,[Yo,t(S,{modelValue:n.value.retries.delaySeconds,"onUpdate:modelValue":i[4]||(i[4]=c=>n.value.retries.delaySeconds=c),inputId:"retries-delay-seconds",showButtons:"",buttonLayout:"horizontal",min:1,step:1,disabled:o.disabled},{incrementbuttonicon:p(()=>[Go]),decrementbuttonicon:p(()=>[Qo]),_:1},8,["modelValue","disabled"])])])]),e("div",Xo,[Zo,t(f,{id:"hmac",modelValue:n.value.hmac.key,"onUpdate:modelValue":i[5]||(i[5]=c=>n.value.hmac.key=c),modelModifiers:{trim:!0},disabled:o.disabled},null,8,["modelValue","disabled"])]),e("div",et,[e("div",st,[ot,t(h,{modelValue:r.value,"onUpdate:modelValue":i[6]||(i[6]=c=>r.value=c),id:"customHeaders",onLabel:"Headers On",offLabel:"Headers Off"},{icon:p(()=>[t(U,{icon:"fa-solid fa-fingerprint",class:"mr-2"})]),_:1},8,["modelValue"])]),r.value?(u(),R(k,{key:0,modelValue:n.value.customHeaders,"onUpdate:modelValue":i[7]||(i[7]=c=>n.value.customHeaders=c),"key-column":"name","key-column-name":"Header",prefix:"X-Header-"},null,8,["modelValue"])):B("",!0)])]),_:1})]),_:1})}}},nt={class:"flex flex-column gap-2"},lt={class:"flex justify-content-between align-items-center w-full"},it=e("h5",null,"🔄 Webhooks",-1),at={class:"pr-2"},rt={key:0,class:"text-300 text-center"},dt={__name:"SessionWebhooksField",props:re({disabled:Boolean},{webhooks:{},webhooksModifiers:{}}),emits:["update:webhooks"],setup(o){const n=K(o,"webhooks");function l(){const r={url:"https://httpbin.org/post",events:["session.status","message"],hmac:{key:null},retries:{delaySeconds:2,attempts:15},customHeaders:null};n.value.push(r)}function s(r){n.value.splice(r,1)}return(r,m)=>{const i=F,d=tt;return u(),C("div",nt,[e("div",lt,[it,e("div",at,[t(i,{label:"Add Webhook",text:"",icon:"pi pi-plus",severity:"success",onClick:l})])]),n.value.length===0?(u(),C("div",rt," No webhooks configured ")):(u(!0),C(A,{key:1},fe(n.value,(f,v)=>(u(),R(d,{webhook:n.value[v],"onUpdate:webhook":S=>n.value[v]=S,index:v,total:n.value.length,onRemove:S=>s(v),disabled:o.disabled},null,8,["webhook","onUpdate:webhook","index","total","onRemove","disabled"]))),256))])}}},ut=e("div",null,[e("h5",null,[e("i",{class:"pi pi-whatsapp"}),j(" Create Session ")])],-1),ct={class:"mb-2"},pt=e("b",null,"Server",-1),mt=e("b",null,"Name",-1),vt={class:"field"},ft=e("label",{for:"server"},"Server",-1),_t={key:0,class:"p-invalid"},gt={class:"field"},bt=e("label",{for:"name"},"Name (optional)",-1),ht={key:0,class:"mb-4"},yt=e("div",{class:"mb-3"},[e("h5",null,"🏭 Engine Settings ")],-1),St={class:"flex flex-column gap-2"},$t=e("div",null,[e("a",{href:"https://waha.devlike.pro/docs/engines/noweb",target:"_blank"},"Read more about NOWEB settings")],-1),wt={class:"pi pi-info-circle"},xt={class:"field mt-4"},kt={class:"field flex justify-content-between align-items-center"},Ct=e("div",null,[e("h5",null,[e("label",{for:"proxy"},"🌐 Proxy")])],-1),Vt={key:0,class:"card mb-4"},Dt={class:"field"},Ut=e("label",{for:"proxy-server"},"Server",-1),Rt={key:0,class:"p-invalid"},Tt={class:"flex gap-3"},Lt={class:"field w-full"},Bt=e("label",{for:"proxy-username"},"Username (optional)",-1),Mt={class:"field w-full"},Nt=e("label",{for:"proxy-password"},"Password (optional)",-1),It={class:"field flex justify-content-between align-items-center"},jt=e("div",null,[e("h5",null,[e("label",{for:"debug"},"🛠️ Debug")])],-1),Et={class:"w-full flex flex-column gap-2"},Ot={class:"flex justify-content-end"},At={__name:"SessionDialog",props:re({mode:String},{visible:{},visibleModifiers:{},session:{},sessionModifiers:{}}),emits:["update:visible","update:session"],setup(o){var O,G;const n=_e(),l=K(o,"visible"),s=K(o,"session"),r=o,m=L(()=>r.mode==="new"),i=L(()=>r.mode==="update"),d=L(()=>i.value),f=Re(),v=z(),S=L(()=>v.getServer(s.value.server)),U=L(()=>{var y,_;return((_=(y=S.value)==null?void 0:y.version)==null?void 0:_.engine)==="NOWEB"});L(()=>{var y,_;return((_=(y=S.value)==null?void 0:y.version)==null?void 0:_.engine)==="WEBJS"});const h=x([]),k=x(!!((G=(O=s.value.config)==null?void 0:O.proxy)!=null&&G.server));ge(s,async(y,_)=>{var H,q,se;k.value=(q=(H=y==null?void 0:y.config)==null?void 0:H.proxy)==null?void 0:q.server,h.value=Ds((se=y.config)==null?void 0:se.metadata)});const V=x(!1),$=x(!1),a=L(()=>{const y=Z.cloneDeep(s.value.config);return k.value||(y.proxy=void 0),y.metadata=Us(h.value),y}),c=L(()=>{const y={...a.value};return U.value||delete y.noweb,{name:s.value.name,config:y}});async function M(){V.value=!0;try{$.value=!0;const y=Z.cloneDeep(c.value);await f(v.updateSession(s.value.server,s.value.name,y.config),void 0,"Failed to update session"),n.add({severity:"success",summary:"Updated",detail:s.value.name,life:3e3})}finally{$.value=!1}s.value=void 0,ee()}async function Y(y){V.value=!0;try{$.value=!0;const _=Z.cloneDeep(c.value);_.start=y;const H=await f(v.createSession(s.value.server,_),void 0,"Failed to start session"),q=y?"Started":"Created";n.add({severity:"success",summary:q,detail:H.name,life:3e3})}finally{$.value=!1}s.value=void 0,ee()}function ee(){V.value=!1,l.value=!1}const E=L(()=>s.value.status==="STOPPED");async function le(y){await navigator.clipboard.writeText(JSON.stringify({method:"POST",uri:"/api/sessions",body:c.value},null,2)),y.preventDefault()}return(y,_)=>{const H=He,q=xs,se=qe,ie=ae,ue=ks,oe=De("font-awesome-icon"),te=Ne,ce=Ie,pe=je,me=Pe,T=dt,w=Vs,Q=F,ve=Me,ne=J("tooltip");return u(),R(ve,{visible:l.value,"onUpdate:visible":_[14]||(_[14]=D=>l.value=D),modal:!0,class:"p-fluid",maximizable:""},ms({footer:p(()=>[e("div",Et,[e("div",null,[i.value&&!E.value?(u(),R(q,{key:0,severity:"warn"},{default:p(()=>[j(" The session is in '"),e("b",null,I(s.value.status)+"'",1),j(" status, in order to save configuration the session will be restarted. ")]),_:1})):B("",!0)]),e("div",Ot,[N(t(Q,{label:"Copy",text:"",tabindex:0,icon:"pi pi-copy",severity:"secondary",onClick:_[11]||(_[11]=D=>le(D))},null,512),[[ne,{value:"Copied to clipboard"},void 0,{focus:!0,bottom:!0}]]),i.value?B("",!0):(u(),R(Q,{key:0,label:"Create",icon:"pi pi-plus",text:"",onClick:_[12]||(_[12]=D=>Y(!1)),loading:$.value},null,8,["loading"])),i.value?B("",!0):(u(),R(Q,{key:1,label:"Create & Start",icon:"pi pi-play",text:"",onClick:_[13]||(_[13]=D=>Y(!0)),loading:$.value},null,8,["loading"])),i.value?(u(),R(Q,{key:2,label:"Update",icon:"pi pi-save",text:"",onClick:M,loading:$.value},null,8,["loading"])):B("",!0)])])]),default:p(()=>[e("div",ct,[i.value?(u(),R(q,{key:0,severity:"info"},{default:p(()=>[j(" To change the "),pt,j(" or "),mt,j(" - please remove the session and run again. ")]),_:1})):B("",!0)]),e("div",vt,[ft,t(se,{placeholder:"Select Server",modelValue:s.value.server,"onUpdate:modelValue":_[0]||(_[0]=D=>s.value.server=D),showClear:!1,required:!0,invalid:V.value&&!s.value.server,disabled:d.value},null,8,["modelValue","invalid","disabled"]),V.value&&!s.value.server?(u(),C("small",_t,"Server is required.")):B("",!0)]),e("div",gt,[bt,t(ie,{id:"name",modelValue:s.value.name,"onUpdate:modelValue":_[1]||(_[1]=D=>s.value.name=D),modelModifiers:{trim:!0},required:"false",autofocus:"",placeholder:"session_1111111111111",disabled:!m.value},null,8,["modelValue","disabled"])]),U.value?(u(),C("div",ht,[yt,t(pe,{activeIndex:0},{default:p(()=>[t(ce,{header:"NOWEB"},{header:p(()=>[j("  "),t(ue,{value:"New"})]),default:p(()=>[e("div",St,[$t,e("div",null,[N((u(),R(te,{modelValue:s.value.config.noweb.store.enabled,"onUpdate:modelValue":_[2]||(_[2]=D=>s.value.config.noweb.store.enabled=D),onLabel:"Store: Enabled",offLabel:"Store: Disabled",disabled:d.value},{icon:p(()=>[t(oe,{icon:"fa-solid fa-folder",class:"mr-2"})]),_:1},8,["modelValue","disabled"])),[[ne,"Store contacts, chats, messages in the database, so you can get it in API"]])]),e("div",null,[N((u(),R(te,{modelValue:s.value.config.noweb.store.fullSync,"onUpdate:modelValue":_[3]||(_[3]=D=>s.value.config.noweb.store.fullSync=D),onLabel:"Store: Full Sync On",offLabel:"Store: Full Sync Off",disabled:d.value},{icon:p(()=>[t(oe,{icon:"fa-solid fa-sync",class:"mr-2"})]),_:1},8,["modelValue","disabled"])),[[ne,`Sync all contacts, chats, messages from the phone at the start.
Otherwise the store can miss some information.`]])])])]),_:1})]),_:1})])):B("",!0),e("div",null,[e("div",null,[e("h5",null,[j("📝 Metadata "),N(e("i",wt,null,512),[[ne,"Key value pairs you can attach to Session and will receive it in webhooks, API and search the values on Dashboard."]])])]),t(me,{modelValue:h.value,"onUpdate:modelValue":_[4]||(_[4]=D=>h.value=D),"key-column":"key","key-column-name":"Key",prefix:"user.id."},null,8,["modelValue"])]),e("div",xt,[t(T,{ref:"webhooks",webhooks:s.value.config.webhooks,"onUpdate:webhooks":_[5]||(_[5]=D=>s.value.config.webhooks=D)},null,8,["webhooks"])]),e("div",null,[e("div",kt,[Ct,t(te,{modelValue:k.value,"onUpdate:modelValue":_[6]||(_[6]=D=>k.value=D),id:"proxy",onLabel:"Proxy On",offLabel:"Proxy Off"},{icon:p(()=>[t(oe,{icon:"fa-solid fa-server",class:"mr-2"})]),_:1},8,["modelValue"])]),k.value?(u(),C("div",Vt,[e("div",Dt,[Ut,t(ie,{id:"proxy-server",modelValue:s.value.config.proxy.server,"onUpdate:modelValue":_[7]||(_[7]=D=>s.value.config.proxy.server=D),modelModifiers:{trim:!0},required:"true",invalid:V.value&&!s.value.config.proxy.server,placeholder:"host:port"},null,8,["modelValue","invalid"]),V.value&&!s.value.config.proxy.server?(u(),C("small",Rt,"Server is required.")):B("",!0)]),e("div",Tt,[e("div",Lt,[Bt,t(ie,{id:"proxy-username",modelValue:s.value.config.proxy.username,"onUpdate:modelValue":_[8]||(_[8]=D=>s.value.config.proxy.username=D),modelModifiers:{trim:!0}},null,8,["modelValue"])]),e("div",Mt,[Nt,t(w,{id:"proxy-password",modelValue:s.value.config.proxy.password,"onUpdate:modelValue":_[9]||(_[9]=D=>s.value.config.proxy.password=D),modelModifiers:{trim:!0},feedback:!1,toggleMask:""},null,8,["modelValue"])])])])):B("",!0)]),e("div",It,[jt,t(te,{modelValue:s.value.config.debug,"onUpdate:modelValue":_[10]||(_[10]=D=>s.value.config.debug=D),onLabel:"Debug Enabled",offLabel:"Debug Disabled",onIcon:"fa fa-bug"},{icon:p(()=>[t(oe,{icon:"fa-solid fa-bug",class:"mr-2"})]),_:1},8,["modelValue"])])]),_:2},[m.value?{name:"header",fn:p(()=>[ut]),key:"0"}:void 0,m.value?void 0:{name:"header",fn:p(()=>[e("div",null,[t(H,{session:s.value},null,8,["session"])])]),key:"1"}]),1032,["visible"])}}},qt=["WORKING","FAILED","STARTING","SCAN_QR_CODE","STOPPED"],Ft={class:"flex justify-content-between"},Ht={class:"flex align-items-center gap-1"},Pt=e("i",{class:"pi pi-whatsapp"},null,-1),Wt=e("span",{class:"mr-1"}," Sessions ",-1),Kt=["disabled"],zt=e("i",{class:"pi pi-refresh"},null,-1),Jt=[zt],Yt={class:"flex justify-content-between flex-column sm:flex-row gap-2 sm:gap-0"},Gt={class:"flex flex-column"},Qt={class:"flex justify-content-between flex-column sm:flex-row gap-2 sm:gap-2"},Xt={style:{"text-align":"left"},class:"flex flex-column"},Zt={class:"text-center"},en={class:"flex gap-2"},sn={class:"my-auto"},on={class:"flex flex-row gap-2 justify-content-end",style:{order:"2"}},Tn={__name:"SessionTable",setup(o){const n=_e(),l=z(),{allSessions:s,refreshing:r,servers:m}=Ce(l),i=s,d=x({config:{webhooks:[]}}),f=x(!1),v=x(void 0),S=x(!1),U=x(10);x(null);const h=x({}),k=x(null),V=x([]),$=L(()=>V.value.filter(T=>a.value[`session-action-${T.server.id}-${T.name}`])),a=x({});function c(T){$.value.forEach(w=>{a.value[`session-action-${w.server.id}-${w.name}`][T]()})}vs(()=>{a.value=[]}),fs(()=>{ie()});const M=x([{field:"name",header:"Name"},{field:"metadata",header:"Metadata"},{field:"me",header:"Me"},{field:"status",header:"Status"},{field:"server",header:"Server"}]);function Y(){return JSON.parse(localStorage.getItem("sessions.table.columns.hidden"))||[]}const ee=Y(),E=x(Z.differenceBy(M.value,ee,"field")),le=T=>{E.value=M.value.filter(w=>T.includes(w))};function O(T){return!E.value||E.value.length===0?!0:Z.find(E.value,{field:T})}const G=L(()=>O("name")),y=L(()=>O("metadata")),_=L(()=>O("me")),H=L(()=>O("status")),q=L(()=>O("server")),se=L(()=>Z.differenceBy(M.value,E.value,"field"));ge(()=>se.value,T=>{localStorage.setItem("sessions.table.columns.hidden",JSON.stringify(T))},{deep:!0});const ie=()=>{h.value={global:{value:null,matchMode:de.CONTAINS},status:{value:null,matchMode:de.EQUALS},"server.id":{value:null,matchMode:de.EQUALS},name:{operator:_s.AND,constraints:[{value:null,matchMode:de.STARTS_WITH}]}}};function ue(){const T=m.value.find(w=>w.connected);if(!T){n.add({severity:"error",summary:"No connected server",detail:"Please connect to a server first",life:3e3});return}d.value={server:T.id,name:"",config:{metadata:{"user.id":"123"},webhooks:[{url:"https://httpbin.org/post",events:["session.status","message"],hmac:{key:null},retries:{delaySeconds:2,attempts:15},customHeaders:null}],noweb:{store:{enabled:!0,fullSync:!1}},proxy:{}}},v.value="new",f.value=!0}function oe(T){d.value=Z.cloneDeep({name:T.name,status:T.status,server:T.server.id,config:T.config}),v.value="update",f.value=!0}function te(){Se("store",async()=>await l.refresh())}function ce(T){pe(T.data)}function pe(T){S.value=!0,d.value=T}const me=L(()=>["name","me.id","me.pushName","_metadata"]);return(T,w)=>{const Q=$e,ve=F,ne=we,D=is,We=ae,Ke=as,X=xe,ze=Ls,Je=Ee,Ye=Fs,ye=Te,Ge=be,Qe=qe,Xe=Fe,Ze=Js,es=Be,ss=Le,os=Bo,ts=At,ns=J("tooltip");return u(),C(A,null,[e("div",Ft,[e("div",null,[e("h5",Ht,[Pt,Wt,t(Q,{refreshing:g(r)},null,8,["refreshing"])])]),e("div",null,[N((u(),C("button",{onClick:te,class:"p-link layout-topbar-button",disabled:g(r)},Jt,8,Kt)),[[ns,"Refresh",void 0,{top:!0}]])])]),t(es,{selection:V.value,"onUpdate:selection":w[6]||(w[6]=b=>V.value=b),value:g(i).length>0?g(i):[],paginator:!0,rows:U.value,rowsPerPageOptions:[5,10,20,50,100,500],dataKey:b=>`${b.server.id}-${b.name}`,rowHover:!0,filters:h.value,"onUpdate:filters":w[7]||(w[7]=b=>h.value=b),filterDisplay:"row",loading:k.value,globalFilterFields:g(me),onRowClick:ce,showGridlines:"",class:"p-datatable--clickable",style:{"white-space":"nowrap"}},{header:p(()=>[e("div",Yt,[e("div",Gt,[t(ve,{label:"Start New",icon:"pi pi-play",severity:"success",onClick:ue})]),e("div",Qt,[e("div",Xt,[t(ne,{placeholder:"Columns",modelValue:E.value,options:M.value,optionLabel:"header",selectedItemsLabel:"Columns",maxSelectedLabels:0,"onUpdate:modelValue":le},null,8,["modelValue","options"])]),t(Ke,{iconPosition:"left"},{default:p(()=>[t(D,{class:"pi pi-search"}),t(We,{modelValue:h.value.global.value,"onUpdate:modelValue":w[0]||(w[0]=b=>h.value.global.value=b),placeholder:"Search by name, phone, metadata",style:{width:"100%"}},null,8,["modelValue"])]),_:1})])])]),empty:p(()=>[j(" No sessions found")]),loading:p(()=>[j(" Loading sessions...")]),default:p(()=>[t(X,{selectionMode:"multiple",headerStyle:"width: 3rem"}),g(G)?(u(),R(X,{key:0,field:"name",header:"Name",sortable:""})):B("",!0),g(y)?(u(),R(X,{key:1,header:"Metadata"},{body:p(({data:b})=>{var P;return[t(ze,{metadata:(P=b.config)==null?void 0:P.metadata},null,8,["metadata"])]}),_:1})):B("",!0),g(_)?(u(),R(X,{key:2,header:"Me"},{body:p(({data:b})=>[e("div",Zt,[t(Je,{session:b},null,8,["session"])])]),_:1})):B("",!0),g(H)?(u(),R(X,{key:3,field:"status",header:"Status",showFilterMenu:!1,style:{width:"9rem"}},{body:p(({data:b})=>[e("div",en,[e("div",null,[t(Ye,{session:b},null,8,["session"])]),e("div",sn,[t(ye,{status:b.status,value:b.status.toUpperCase()},null,8,["status","value"])])])]),filter:p(({filterModel:b,filterCallback:P})=>[t(Ge,{modelValue:b.value,"onUpdate:modelValue":W=>b.value=W,options:g(qt),onChange:W=>P(),placeholder:"Any",class:"p-column-filter",showClear:!0},{option:p(({option:W})=>[t(ye,{status:W,value:W},null,8,["status","value"])]),_:2},1032,["modelValue","onUpdate:modelValue","options","onChange"])]),_:1})):B("",!0),g(q)?(u(),R(X,{key:4,field:"server.name",filterField:"server.id",header:"Server",showFilterMenu:!1},{filter:p(({filterModel:b,filterCallback:P})=>[t(Qe,{placeholder:"Any",onChange:W=>P(),modelValue:b.value,"onUpdate:modelValue":W=>b.value=W,showClear:!0,required:!1},null,8,["onChange","modelValue","onUpdate:modelValue"])]),_:1})):B("",!0),t(X,{showFilterMenu:!1},{filter:p(()=>[e("div",on,[t(Xe,{group:"dialog",name:`'${g($).length}' sessions`,"all-disabled":g($).length===0,"hide-actions":["view"],onStart:w[1]||(w[1]=b=>c("startSession")),onRestart:w[2]||(w[2]=b=>c("restartSession")),onStop:w[3]||(w[3]=b=>c("stopSession")),onLogout:w[4]||(w[4]=b=>c("logoutSession")),onDelete:w[5]||(w[5]=b=>c("deleteSession"))},null,8,["name","all-disabled"])])]),body:p(({data:b})=>[t(Ze,{ref:P=>{a.value[`session-action-${b.server.id}-${b.name}`]=P},session:b,disabled:g($).length!==0,onView:oe},null,8,["session","disabled"])]),_:1})]),_:1},8,["selection","value","rows","dataKey","filters","loading","globalFilterFields"]),t(ss),t(os,{visible:S.value,"onUpdate:visible":w[8]||(w[8]=b=>S.value=b),session:d.value,"onUpdate:session":w[9]||(w[9]=b=>d.value=b)},null,8,["visible","session"]),t(ts,{visible:f.value,"onUpdate:visible":w[10]||(w[10]=b=>f.value=b),session:d.value,"onUpdate:session":w[11]||(w[11]=b=>d.value=b),mode:v.value},null,8,["visible","session","mode"])],64)}}};export{Tn as _};
